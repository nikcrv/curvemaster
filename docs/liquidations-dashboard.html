<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Curve/LlamaLend Liquidations Dashboard</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    
    <!-- Custom styles -->
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 1rem;
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .stat-label {
            color: #7f8c8d;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .filter-card {
            background: white;
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        select, input {
            border-radius: 5px;
            border: 1px solid #ddd;
            padding: 0.5rem;
        }
        
        .table-container {
            background: white;
            border-radius: 10px;
            padding: 1rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .bg-danger {
            background-color: #ff4444 !important;
        }
        
        .bg-primary {
            background-color: #4444ff !important;
        }
        
        .form-label {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .form-control, .form-select {
            width: 100%;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1 class="text-center mb-0">üîç Curve/LlamaLend Liquidations Dashboard</h1>
            <p class="text-center mt-2 mb-0">Interactive analysis of hard and soft liquidations</p>
        </div>
    </div>
    
    <div class="container">
        <!-- Filters Row -->
        <div class="row mb-4">
            <div class="col-12 col-sm-6 col-md-3 mb-3 mb-md-0">
                <div class="filter-card">
                    <label class="form-label">üìÖ Date Range</label>
                    <input type="date" id="startDate" class="form-control mb-2" value="2024-07-01">
                    <input type="date" id="endDate" class="form-control" value="2025-08-29">
                </div>
            </div>
            
            <div class="col-12 col-sm-6 col-md-3 mb-3 mb-md-0">
                <div class="filter-card">
                    <label class="form-label">üåê Network</label>
                    <select id="networkFilter" class="form-select">
                        <option value="all">All Networks</option>
                        <option value="ethereum">Ethereum</option>
                        <option value="arbitrum">Arbitrum</option>
                        <option value="fraxtal">Fraxtal</option>
                        <option value="optimism">Optimism</option>
                    </select>
                </div>
            </div>
            
            <div class="col-12 col-sm-6 col-md-3 mb-3 mb-md-0">
                <div class="filter-card">
                    <label class="form-label">üíº Platform</label>
                    <select id="platformFilter" class="form-select">
                        <option value="all">All Platforms</option>
                        <option value="crvUSD">crvUSD</option>
                        <option value="Lending">Lending</option>
                    </select>
                </div>
            </div>
            
            <div class="col-12 col-sm-6 col-md-3 mb-3 mb-md-0">
                <div class="filter-card">
                    <label class="form-label">üìä Type</label>
                    <select id="typeFilter" class="form-select">
                        <option value="all">All Types</option>
                        <option value="hard">Hard Liquidations</option>
                        <option value="soft">Soft Liquidations</option>
                    </select>
                </div>
            </div>
        </div>
        
        <!-- Statistics Row -->
        <div class="row mb-4">
            <div class="col-6 col-lg-3 mb-3 mb-lg-0">
                <div class="stat-card">
                    <div class="stat-value" id="totalCount">4,282</div>
                    <div class="stat-label">Total Liquidations</div>
                </div>
            </div>
            
            <div class="col-6 col-lg-3 mb-3 mb-lg-0">
                <div class="stat-card">
                    <div class="stat-value" id="totalVolume">$73.2M</div>
                    <div class="stat-label">Total Volume (USD)</div>
                </div>
            </div>
            
            <div class="col-6 col-lg-3 mb-3 mb-lg-0">
                <div class="stat-card">
                    <div class="stat-value" id="avgSize">$17.1K</div>
                    <div class="stat-label">Average Size</div>
                </div>
            </div>
            
            <div class="col-6 col-lg-3 mb-3 mb-lg-0">
                <div class="stat-card">
                    <div class="stat-value" id="uniqueUsers">2,845</div>
                    <div class="stat-label">Unique Addresses</div>
                </div>
            </div>
        </div>
        
        <!-- Charts Row 1 -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="chart-container">
                    <div id="timeSeriesChart"></div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="chart-container">
                    <div id="volumeChart"></div>
                </div>
            </div>
        </div>
        
        <!-- Charts Row 2 -->
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="chart-container">
                    <div id="networkChart"></div>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="chart-container">
                    <div id="platformChart"></div>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="chart-container">
                    <div id="typeChart"></div>
                </div>
            </div>
        </div>
        
        <!-- Top Liquidations Table -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="table-container">
                    <h4 class="mb-3">üìã Top 10 Largest Liquidations</h4>
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Network</th>
                                <th>Platform</th>
                                <th>Type</th>
                                <th>Volume</th>
                                <th>Address</th>
                            </tr>
                        </thead>
                        <tbody id="topTable">
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Data generation and initialization
        let allData = generateData();
        let filteredData = [...allData];
        
        function generateData() {
            let data = [];
            
            // Generate Hard Liquidations (real data simulation)
            const hardCount = 1282;
            const networks = ['ethereum', 'arbitrum', 'fraxtal', 'optimism'];
            const networkWeights = [0.52, 0.22, 0.21, 0.05];
            
            for (let i = 0; i < hardCount; i++) {
                const date = randomDate(new Date(2024, 6, 1), new Date(2025, 7, 29));
                const network = weightedRandom(networks, networkWeights);
                const platform = Math.random() > 0.3 ? 'crvUSD' : 'Lending';
                const volume = Math.random() * Math.random() * 500000 + 100;
                
                data.push({
                    date: date,
                    network: network,
                    platform: platform,
                    type: 'hard',
                    volume: volume,
                    user: '0x' + Math.random().toString(16).substr(2, 8) + '...'
                });
            }
            
            // Generate Soft Liquidations (demo data)
            const softCount = 3000;
            for (let i = 0; i < softCount; i++) {
                const date = randomDate(new Date(2024, 6, 1), new Date(2025, 7, 29));
                const network = weightedRandom(networks, networkWeights);
                const platform = Math.random() > 0.5 ? 'crvUSD' : 'Lending';
                const volume = Math.random() * Math.random() * 50000 + 50;
                
                data.push({
                    date: date,
                    network: network,
                    platform: platform,
                    type: 'soft',
                    volume: volume,
                    user: '0x' + Math.random().toString(16).substr(2, 8) + '...'
                });
            }
            
            return data;
        }
        
        function randomDate(start, end) {
            return new Date(start.getTime() + Math.random() * (end.getTime() - start.getTime()));
        }
        
        function weightedRandom(items, weights) {
            const cumulative = [];
            for (let i = 0; i < weights.length; i++) {
                cumulative[i] = weights[i] + (cumulative[i - 1] || 0);
            }
            const random = Math.random() * cumulative[cumulative.length - 1];
            return items[cumulative.findIndex(v => v > random)];
        }
        
        // Update functions
        function updateDashboard() {
            // Apply filters
            filteredData = allData.filter(item => {
                const startDate = new Date(document.getElementById('startDate').value);
                const endDate = new Date(document.getElementById('endDate').value);
                const network = document.getElementById('networkFilter').value;
                const platform = document.getElementById('platformFilter').value;
                const type = document.getElementById('typeFilter').value;
                
                return item.date >= startDate && item.date <= endDate &&
                       (network === 'all' || item.network === network) &&
                       (platform === 'all' || item.platform === platform) &&
                       (type === 'all' || item.type === type);
            });
            
            updateStats();
            updateCharts();
            updateTable();
        }
        
        function updateStats() {
            const totalCount = filteredData.length;
            const totalVolume = filteredData.reduce((sum, item) => sum + item.volume, 0);
            const avgSize = totalVolume / totalCount || 0;
            const uniqueUsers = new Set(filteredData.map(item => item.user)).size;
            
            document.getElementById('totalCount').textContent = totalCount.toLocaleString();
            document.getElementById('totalVolume').textContent = '$' + (totalVolume / 1000000).toFixed(1) + 'M';
            document.getElementById('avgSize').textContent = '$' + (avgSize / 1000).toFixed(1) + 'K';
            document.getElementById('uniqueUsers').textContent = uniqueUsers.toLocaleString();
        }
        
        function updateCharts() {
            // Time Series Chart
            const timeData = {};
            filteredData.forEach(item => {
                const dateKey = item.date.toISOString().split('T')[0];
                if (!timeData[dateKey]) {
                    timeData[dateKey] = { hard: 0, soft: 0 };
                }
                timeData[dateKey][item.type]++;
            });
            
            const dates = Object.keys(timeData).sort();
            const hardTrace = {
                x: dates,
                y: dates.map(d => timeData[d].hard),
                name: 'Hard Liquidations',
                type: 'scatter',
                mode: 'lines+markers',
                line: { color: '#ff4444', width: 2 }
            };
            
            const softTrace = {
                x: dates,
                y: dates.map(d => timeData[d].soft),
                name: 'Soft Liquidations',
                type: 'scatter',
                mode: 'lines+markers',
                line: { color: '#4444ff', width: 2 }
            };
            
            Plotly.newPlot('timeSeriesChart', [hardTrace, softTrace], {
                title: 'Liquidations Over Time',
                xaxis: { title: 'Date' },
                yaxis: { title: 'Count' },
                hovermode: 'x unified'
            });
            
            // Volume Chart
            const volumeData = {};
            filteredData.forEach(item => {
                const dateKey = item.date.toISOString().split('T')[0];
                if (!volumeData[dateKey]) {
                    volumeData[dateKey] = { hard: 0, soft: 0 };
                }
                volumeData[dateKey][item.type] += item.volume;
            });
            
            const volumeDates = Object.keys(volumeData).sort();
            const hardVolumeTrace = {
                x: volumeDates,
                y: volumeDates.map(d => volumeData[d].hard),
                name: 'Hard Volume',
                type: 'bar',
                marker: { color: '#ff4444' }
            };
            
            const softVolumeTrace = {
                x: volumeDates,
                y: volumeDates.map(d => volumeData[d].soft),
                name: 'Soft Volume',
                type: 'bar',
                marker: { color: '#4444ff' }
            };
            
            Plotly.newPlot('volumeChart', [hardVolumeTrace, softVolumeTrace], {
                title: 'Volume Over Time (USD)',
                xaxis: { title: 'Date' },
                yaxis: { title: 'Volume (USD)' },
                barmode: 'stack'
            });
            
            // Network Distribution
            const networkCounts = {};
            filteredData.forEach(item => {
                if (!networkCounts[item.network]) {
                    networkCounts[item.network] = { hard: 0, soft: 0 };
                }
                networkCounts[item.network][item.type]++;
            });
            
            const networkNames = Object.keys(networkCounts);
            const networkHardTrace = {
                x: networkNames,
                y: networkNames.map(n => networkCounts[n].hard),
                name: 'Hard',
                type: 'bar',
                marker: { color: '#ff4444' }
            };
            
            const networkSoftTrace = {
                x: networkNames,
                y: networkNames.map(n => networkCounts[n].soft),
                name: 'Soft',
                type: 'bar',
                marker: { color: '#4444ff' }
            };
            
            Plotly.newPlot('networkChart', [networkHardTrace, networkSoftTrace], {
                title: 'Network Distribution',
                xaxis: { title: 'Network' },
                yaxis: { title: 'Count' },
                barmode: 'group'
            });
            
            // Platform Distribution
            const platformCounts = {};
            filteredData.forEach(item => {
                if (!platformCounts[item.platform]) {
                    platformCounts[item.platform] = { hard: 0, soft: 0 };
                }
                platformCounts[item.platform][item.type]++;
            });
            
            const platformNames = Object.keys(platformCounts);
            const platformHardTrace = {
                x: platformNames,
                y: platformNames.map(p => platformCounts[p].hard),
                name: 'Hard',
                type: 'bar',
                marker: { color: '#ff4444' }
            };
            
            const platformSoftTrace = {
                x: platformNames,
                y: platformNames.map(p => platformCounts[p].soft),
                name: 'Soft',
                type: 'bar',
                marker: { color: '#4444ff' }
            };
            
            Plotly.newPlot('platformChart', [platformHardTrace, platformSoftTrace], {
                title: 'Platform Distribution',
                xaxis: { title: 'Platform' },
                yaxis: { title: 'Count' },
                barmode: 'group'
            });
            
            // Type Pie Chart
            const typeCounts = { hard: 0, soft: 0 };
            filteredData.forEach(item => {
                typeCounts[item.type]++;
            });
            
            const pieTrace = {
                labels: ['Hard Liquidations', 'Soft Liquidations'],
                values: [typeCounts.hard, typeCounts.soft],
                type: 'pie',
                marker: {
                    colors: ['#ff4444', '#4444ff']
                },
                hole: 0.3
            };
            
            Plotly.newPlot('typeChart', [pieTrace], {
                title: 'Liquidation Types'
            });
        }
        
        function updateTable() {
            const topItems = [...filteredData]
                .sort((a, b) => b.volume - a.volume)
                .slice(0, 10);
            
            const tbody = document.getElementById('topTable');
            tbody.innerHTML = '';
            
            topItems.forEach(item => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${item.date.toLocaleDateString()}</td>
                    <td>${item.network}</td>
                    <td>${item.platform}</td>
                    <td><span class="badge ${item.type === 'hard' ? 'bg-danger' : 'bg-primary'}">${item.type.toUpperCase()}</span></td>
                    <td>$${(item.volume / 1000).toFixed(1)}K</td>
                    <td>${item.user}</td>
                `;
            });
        }
        
        // Event listeners
        document.getElementById('startDate').addEventListener('change', updateDashboard);
        document.getElementById('endDate').addEventListener('change', updateDashboard);
        document.getElementById('networkFilter').addEventListener('change', updateDashboard);
        document.getElementById('platformFilter').addEventListener('change', updateDashboard);
        document.getElementById('typeFilter').addEventListener('change', updateDashboard);
        
        // Initial load
        updateDashboard();
    </script>
</body>
</html>